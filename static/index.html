<!DOCTYPE html>
<html>
	<head>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">	
		
		<style>
			body {
				min-height: 100vh;
				overflow-y: hidden;
			}
		</style>

	</head>
	<body>
		<div style="height: 100vh" class="row">
			<div class="col s1 valign-wrapper" style="height: 100vh">

				<a onclick="nextSlide(-1)" class="btn-floating btn-large waves-effect waves-light red"><i class="material-icons">navigate_before</i></a>
			</div>
			<div style="height: 100vh" class="col s10">
				<div id="video-container" style="height: 100vh" class="carousel carousel-slider"></div>
			</div>
			<div class="col s1 valign-wrapper" style="height: 100vh">
				<a onclick="nextSlide(1)" class="btn-floating btn-large waves-effect waves-light red"><i class="material-icons">navigate_next</i></a>
			</div>
		</div>

			
		<script type="text/javascript" src="./tiktok-api/tiktok-api.js"></script>
		<script type="text/javascript" src="./templates.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
		<script>
		
			var curr = null;
			function playAweme(vid) {
				if (curr != null) {
					curr.pause()
					curr.currentTime = 0
				}

				curr = vid
				vid.play()
			}

			function nextSlide(num) {
				var car = M.Carousel.getInstance(document.getElementById('video-container'))

				car.next(num)
			}

			// $(document).ready(...)
			document.addEventListener('DOMContentLoaded', function() {
			
				tiktok.getFeed()
				.then(async feed => {
					
					for (i in feed.aweme_list) {
						var url = feed.aweme_list[i].video.play_addr.url_list[0]

						var tpl = await templates.parse('aweme.html', {
							url: url
						})

						document.getElementById('video-container').innerHTML += tpl
					}

					var elems = document.querySelectorAll('.carousel');
					M.Carousel.init(elems, {
						duration: 100,
						fullWidth: true,
						onCycleTo: function(elem) {
							playAweme(elem)
						}
					});
				})

			})
		</script>
	</body>
</html>
